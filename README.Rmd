---
output: github_document
bibliography: inst/REFERENCES.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# intkrige

This package implements the interval-valued kriging models described in Bean et. al. [-@Bean2019-int]. Details regarding the algorithmic implementation can be found in Bean et. al. [-@Bean2019-int2].

## Installation

This is a preliminary version of the intkrige package. The final package will include additional user functions and visualization tools designed to simplify and enhance interval-valued spatial data analysis. This developmental version of the pacakge can be installed by setting the source file location to the parent folder and running the command

``` r
devtools::install()
```

Note that the developmental installation makes use of the devtools package [@devtools2019]. The most current version of this package can be found at \url{https://github.com/r-lib/devtools}. 


## Package Contents

The current version of the package contains one main function named *intkrige*. Information about this function can be obtained by entering
```r
?intkrige::intkrige
```
in the console. 

The package also contains an interval-valued design ground snow load datset named *utsnow*. These data are available by installing the intkrige package and invoking the command

```r
data(utsnow)
```

with dataset documentation obtained by

```r
?utsnow
```

Descriptions for the source folders included in this package are as follows:

- **data**: Includes a copy of the utsnow dataset.
- **data-raw**: Includes the source files used to create utsnow as well as the scripts use to process these data. 
- **inst**: Includes a latex bibliography of citations used in the documentation.
- **man**: Includes files used to render formatted function documentation R.
- **R**: Functions and scripts used to execute the interval-valued kriging models. 
- **src**: c++ version of the interval-valued kriging models created using Rcpp and RcppArmadillo [@rcpp-a; @rcpp; @rcpp2; @rcpp3].


## Example

Once installed, this package runs simple and ordinary interval-valued kriging models. The following example comes from the design ground snow load application described in Bean et. al. [@Bean2019-int]. The example shows how to make an interval valued kriging design ground snow load prediction (after removing the effect of elevation) for Logan, Utah. This example makes use of several existing resources available in the gstat and sp packages [@gstat1; @gstat2; @Bivand2008]. 

```{r example}
# First, define the location and elevation of interest. 
# (In this case we pick coordinates of Utah State University)
lats <- c(41.745)
lons <- c(111.810)
elevation <- c(1456)

# Load the Utah Snow Load Data
data(utsnow)

# Determine the centers and radii on a log scale.
utsnow$center = (log(utsnow$maxDL) + log(utsnow$minDL)) / 2
utsnow$radius = (log(utsnow$maxDL) - log(utsnow$minDL)) / 2

# Scale the interval centers and radii
cLM <- lm(center ~ ELEVATION, data = utsnow)
utsnow$rC <- cLM$residuals
utsnow$rR <- utsnow$radius*(utsnow$ELEVATION/median(utsnow$ELEVATION))

# Extract the variograms for the centered/scaled residuals. 
# This requires converting the provided dataset to a 
# spatialdataframe using the gstat package. 
# Note that the center, radius, and center/radius interaction each
# require their own variograms. 
utsnow.sp <- utsnow
sp::coordinates(utsnow.sp) <- c("LONGITUDE", "LATITUDE")
sp::proj4string(utsnow.sp) <- "+proj=longlat +ellps=WGS84
                              +datum=WGS84 +no_defs +towgs84=0,0,0"
g1 <- gstat::gstat(NULL, "center", rC ~ 1, data = utsnow.sp)
g1 <- gstat::gstat(g1, "radius", rR ~ 1, data = utsnow.sp)

# Automatic variogram fitting uses the gstat package. 
evgm <- gstat::variogram(g1)
vsub1 <- evgm[evgm$id == "center", ]
vsub2 <- evgm[evgm$id == "radius", ]
vsub3 <- evgm[evgm$id == "center.radius", ]
check <- gstat::vgm(model = c("Sph", "Sph", "Gau"))
tvgm1 <- gstat::fit.variogram(vsub1, model = gstat::vgm("Sph"))
tvgm2 <- gstat::fit.variogram(vsub2, model = gstat::vgm("Sph"))
tvgm3 <- gstat::fit.variogram(vsub3, model = gstat::vgm("Gau"))

# Prepare data for function input
input_locs <- sp::coordinates(utsnow.sp)
input_int <- as.matrix(utsnow[, c("rC", "rR")])
pred_locs <-  matrix(c(lons, lats), ncol = 2)

# Run a basic kriging model using argument defaults. 
preds <- intkrige::intkrige(locations = input_locs, measurements = input_int, 
                            newdata = pred_locs, modelC = tvgm1, 
                            modelR = tvgm2, modelCR = tvgm3)

# The final results are predicted intervals after removing the effect of elevation.  
preds
```

Note that the prediction for a single location returns four outputs including (in order): 

- center prediction
- radius prediction
- kriging prediction variance
- 0-1 warning for non-convergent optimization (1 if warning, 0 if not). 

# References


